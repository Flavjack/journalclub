---
format:
  html:
    toc: true
    toc-location: left
    number-sections: true
    self-contained: true
  docx:
    toc: false
    section-numbers: true
    reference-doc: files/unalm.docx
    output-file: "manuscript"
editor_options: 
  chunk_output_type: console
execute:
  echo: false
  warning: false
# crossref:
#   fig-title: Fig.
#   fig-prefix: Fig.
---

```{r}
#| label: setup

source("http://inkaverse.com/docs.r")
# https://docs.google.com/document/d/1EllVJgpV7gWW7dKh6xgwkJeGPlSRPSr5mn3R1h0msG8/edit#

doc <- inti::gdoc2qmd(file = "manuscript.zip", format = "qmd")
```

```{r}
#| results: 'asis'

rticle <- knitr::knit_child(doc, quiet = TRUE)
cat(rticle, sep = '\n')
```

# Image pdf to JPEG

```{r}
library(tidyverse)
library(magick)

pdf4pub <- list.files("files/", pattern = "Fig.*pdf", full.names = T) 

path <- "JoSTE/"

imgs <- 1:length(pdf4pub) %>% map(\(x) {
  
  filename <- pdf4pub[x] %>% 
    basename() %>% 
    gsub(".pdf", "\\1.jpeg", .) 
  
  pdf4pub[x] %>% 
    image_read_pdf() %>% 
    image_write(format = "jpeg", file.path(path, filename))
  
})
```



```{r}
library(tidyverse)

txt <- "manuscript/Journal-Club_article.md" %>%
  readLines() %>% 
  tibble::enframe() %>%
  dplyr::rowwise() %>% 
  filter(!grepl("#fig", .data$value)) %>% 
  filter(!grepl("#tbl", .data$value)) %>% 
  filter(!grepl("^\\|", .data$value)) %>% 
  filter(!grepl("UNSUPPORTED", .data$value)) 

fig <- "manuscript/Journal-Club_article.md" %>%
  readLines() %>% 
  tibble::enframe() %>%
  dplyr::rowwise() %>% 
  filter(grepl("#fig", .data$value)) %>% 
  select(!name) %>% 
  deframe() %>% 
  paste(collapse = "\n\n") %>% 
  paste("\newpage", "\n\n", .)
 
tab <- "manuscript/Journal-Club_article.md" %>%
  readLines() %>% 
  tibble::enframe() %>%
  dplyr::rowwise() %>% 
  filter(grepl("#tbl", .data$value)) %>% 
  select(!name) %>% 
  deframe() %>% 
  paste(collapse = "\n\n") %>% 
  paste("\newpage", "\n\n", .)
  
```



